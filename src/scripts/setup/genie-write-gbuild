#! /usr/bin/perl -w
#
# Creates the $GENIE/src/Conventions/GBuild.h header file
#
# C.Andreopoulos <C.V.Andreopoulos@rl.ac.uk>, Rutherford Lab.
#

$GENIE = $ENV{'GENIE'};
die ("Not even the GENIE environmental variable is defined!") unless defined $GENIE;

# GENIE config file
#
$GCONF_FILE = "$GENIE/src/make/Make.config";
die("Can not open $GENIE/src/make/Make.config!") unless (-e $GCONF_FILE);

# Read the ROOT config 
#
$ROOTSYS = $ENV{'ROOTSYS'};
$RCONF_FILE = "$ROOTSYS/config.status";
$root_conf_status="";
if(-e $RCONF_FILE) {
  open(RCONF, "<$RCONF_FILE") or die("Can not open $ROOTSYS/config.status!");
  @root_conf=<RCONF>;
  close(RCONF);
  chomp($root_conf_status = $root_conf[0]);
}

# Open header file
#
$GBLD_FILE = "$GENIE/src/Conventions/GBuild.h";
open(GBLD, ">$GBLD_FILE") or die("Can not write out the GBuild.h file!");

# Write header file
#
print GBLD "#ifndef _GBUILD_H_ \n";
print GBLD "#define _GBUILD_H_ \n";
print GBLD "/* \n";
print GBLD " * Build information automatically generated by the GENIE installer \n";
print GBLD "*/ \n\n";

@nret = `grep 'GOPT_ENABLE_GIBUU=YES' $GCONF_FILE`;
if(@nret>0) 
      { print GBLD   "#define __GENIE_GIBUU_ENABLED__\n"; }
else  { print GBLD "//#define __GENIE_GIBUU_ENABLED__\n"; }

@nret = `grep 'GOPT_ENABLE_FLUKA=YES' $GCONF_FILE`;
if(@nret>0) 
      { print GBLD   "#define __GENIE_FLUKA_ENABLED__\n"; }
else  { print GBLD "//#define __GENIE_FLUKA_ENABLED__\n"; }

if( $root_conf_status=~m/enable-pythia6/i ) 
      { print GBLD   "#define __GENIE_PYTHIA6_ENABLED__\n"; }
else  { print GBLD "//#define __GENIE_PYTHIA6_ENABLED__\n"; }

if( $root_conf_status=~m/enable-mysql/i ) 
      { print GBLD   "#define __GENIE_MYSQL_ENABLED__\n"; }
else  { print GBLD "//#define __GENIE_MYSQL_ENABLED__\n"; }

@nret = `grep 'GOPT_ENABLE_FLUX_DRIVERS=YES' $GCONF_FILE`;
if(@nret>0) 
      { print GBLD   "#define __GENIE_FLUX_DRIVERS_ENABLED__\n"; }
else  { print GBLD "//#define __GENIE_FLUX_DRIVERS_ENABLED__\n"; }

@nret = `grep 'GOPT_ENABLE_GEOM_DRIVERS=YES' $GCONF_FILE`;
if(@nret>0) 
      { print GBLD   "#define __GENIE_GEOM_DRIVERS_ENABLED__\n"; }
else  { print GBLD "//#define __GENIE_GEOM_DRIVERS_ENABLED__\n"; }

print GBLD "\n#endif\n\n";

# Close header file
close(GBLD);

